import mysql.connector

def stream_users():
    try:
        # Connect to database
        connection = mysql.connector.connect(
            host="localhost",
            user="root",
            password="YysmJaNG#%pWMRf4",
            database="ALX_prodev"
        )

        # ุงุณุชุฎุฏู cursor ุจููุฒุฉ buffered
        cursor = connection.cursor(dictionary=True, buffered=True)

        # ูููุฐ ุงูุงุณุชุนูุงู
        cursor.execute("SELECT user_id, name, email, age FROM user_data")

        # ุงุณุชุฎุฏู yield ูุฅุฑุฌุงุน ุตู ูุงุญุฏ ูู ูุฑุฉ
        for row in cursor:
            yield row

    except mysql.connector.Error as err:
        print(f"Database error: {err}")
    finally:
        # ุงุชุฃูุฏ ุฅู ุงูุงุชุตุงู ุจูุชููู ุจุนุฏ ูุง ุงูุฌููุฑูุชูุฑ ูุฎูุต
        if cursor:
            cursor.close()
        if connection:
            connection.close()

'''
result
{'user_id': '0021d5a1-f01d-4343-88b2-f2937130efbe', 'name': 'Roy Sporer', 'email': 'Russell_Jast64@gmail.com', 'age': Decimal('34.00')}
{'user_id': '00329655-4894-472c-9ca7-8652f644c50c', 'name': 'Dr. Laurence Thiel', 'email': 'Laurie.Lemke20@yahoo.com', 'age': Decimal('22.00')}
{'user_id': '007147bb-df0d-4b63-ae87-0af242b0cd88', 'name': 'Spencer Shields', 'email': 'Calvin_Hayes15@gmail.com', 'age': Decimal('67.00')}
{'user_id': '00b4fb6e-ad99-4717-a07b-329cf51753a1', 'name': 'Tammy Gerhold IV', 'email': 'Fred_Koelpin@hotmail.com', 'age': Decimal('14.00')}
{'user_id': '00c86421-cb39-463d-a488-1cbd11456256', 'name': 'Dr. Kristine Buckridge', 'email': 'Bryant.Schmitt@hotmail.com', 'age': Decimal('92.00')}   
{'user_id': '00e54b68-c2a8-49a5-8f05-4629c7c35a59', 'name': 'Nancy Mueller', 'email': 'Jimmy_Wolf@yahoo.com', 'age': Decimal('42.00')}

ุดุฑุญ ุณุฑูุน:
main-1.py โ ุงูููู ุงููู ุจูุณุชุฎุฏู ุงููููุดู.stream_users โ ุงููููุดู ุงููู ุจุชุนูู streaming ููุจูุงูุงุช.
# islice ุฌูุจ ุฃูู 6 ูุณุชุฎุฏููู โ ุจูุณุชุฎุฏู ุนุดุงู ูุฌูุจ ุฃูู 6 ุตููู ุจุณ.

mysql.connector.connect โ ููุชุญ ุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.

cursor(dictionary=True) โ ูุฎูู ุงูุตููู ุชุทูุน ูู ุดูู dict ุจุฏู tuple.

for row in cursor: โ ุฏู ุงูููุจ ุงููุญูุฏ ุงููู ุจูุนูู streaming ุตู ูุงุญุฏ ูู ุงููุฑุฉ.

yield row โ ุจูุฑุฌุน ุงูุตู ุงูุญุงูู ุจุฏูู ุชุญููู ูู ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ (ูุฏู ุงููุฑู ุจูู generator ู list).

ุงุณุชุฎุฏุงู yield ููุง ุจูุฎูู ุงูููุฏ ูุณุชููู ุงูุฐุงูุฑุฉ ุชุฏุฑูุฌููุง ุจุฏู ูุง ูุญูู ูู ุงูุจูุงูุงุช ูุฑุฉ ูุงุญุฏุฉ.

this is a generator function โ ุงููููุดู ุฏู ุจุชููุฏ ููู ูุงุญุฏุฉ ูุงุญุฏุฉ ุจุฏู ูุง ุชุฑุฌุน ูู ุงูููู ูุฑุฉ ูุงุญุฏุฉ.
this is memory efficient โ ูุฃููุง ุจุชุณุชุฎุฏู ุฐุงูุฑุฉ ุฃูู ููุง ุจุชุชุนุงูู ูุน ุจูุงูุงุช ูุจูุฑุฉ.
this is useful for large datasets โ ูููุฏุฉ ููุง ูููู ุนูุฏู ุจูุงูุงุช ูุชูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
this avoids loading everything into memory at once โ ุจุชุฌูุจ ุชุญููู ูู ุญุงุฌุฉ ูู ุงูุฐุงูุฑุฉ ูุฑุฉ ูุงุญุฏุฉ.
this ensures connections are closed properly โ ุฏู ุจูุถูู ุฅู ุงูุงุชุตุงูุงุช ุจุชุชููู ุจุดูู ุตุญูุญ ุจุนุฏ ุงูุงุณุชุฎุฏุงู.
this handles database errors gracefully โ ุฏู ุจูุชุนุงูู ูุน ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ูุทูู.
this allows iteration over database rows one at a time โ ุฏู ุจูุณูุญ ุจุงูุชูุฑุงุฑ ุนูู ุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุญุฏ ูุงุญุฏ.
instead of fetching all rows at once โ ุจุฏู ูุง ุชุฌูุจ ูู ุงูุตููู ูุฑุฉ ูุงุญุฏุฉ.
using buffered cursor โ ุจุงุณุชุฎุฏุงู cursor ุจููุฒุฉ buffered.
this is important for generators โ ุฏู ููู ููุฌููุฑูุชูุฑุฒ.
used in the context of streaming database results โ ุจูุณุชุฎุฏู ูู ุณูุงู streaming ููุชุงุฆุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช.
and fetching rows one by one โ ูุฌูุจ ุงูุตููู ูุงุญุฏ ูุงุญุฏ.




๐ฏ ุงูููุฑุฉ ุงูุนุงูุฉ

ููุง ุชูุชุจ ููุฏ ุนุงุฏู ุฒู ุฏู:

cursor.execute("SELECT * FROM user_data")
rows = cursor.fetchall()


ูู fetchall() ุจุชู ุชุฌูุจ ูู ุงูุตููู ูุฑุฉ ูุงุญุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุญุทูุง ูู ุงูุฐุงูุฑุฉ (RAM).
ูุนูู ูู ุนูุฏู 100 ุฃูู ุตูุ ูููู ุจูุชุญูููุง ูู ุงูููููุฑู ูุจู ูุง ุชุจุฏุฃ ุชุชุนุงูู ูุนุงูู.

๐ง ุงููุชูุฌุฉ:

ุณุฑูุน ูู ุงูุญุงูุงุช ุงูุตุบูุฑุฉ โ

ููู ูุน ุงูุจูุงูุงุช ุงููุจูุฑุฉ โ ุจูุณุชููู ุฐุงูุฑุฉ ุถุฎูุฉ ุฌุฏูุง โ

โ๏ธ ุฅููุง ุงูู Generator ุจูุบููุฑ ุฏู ุชูุงููุง

ููุง ูุนูู ูุฏู:

def stream_users():
    cursor.execute("SELECT * FROM user_data")
    for row in cursor:
        yield row


ููู ูุฑุฉ ุชุณุชุฎุฏู next() ุนูู ุงููููุฏ (ุงููู ุจูุญุตู ุถููููุง ูู ุงูู for loop)ุ
ุจูุชู ูุฑุงุกุฉ ุตู ูุงุญุฏ ููุท ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุฑุฌุงุนู.

ูุนูู:

ูุงููุด ุชุญููู ูุงูู ููู ุงูุตููู.

ุจูุฌูุจ ุตู ูุงุญุฏ ูู ูู ุฏูุฑุฉ โ ูุณุชุฎุฏูู โ ุจุนุฏูู ูุฌูุจ ุงููู ุจุนุฏู.

๐งฉ ูุซุงู ุชูุถูุญู

ุชุฎูู ุนูุฏู ุฌุฏูู ููู 1,000,000 ุตู.

ุงูุทุฑููุฉ ุงููุฏููุฉ (fetchall):

ุงูุจุฑูุงูุฌ ููุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฑุฌุน ุงูููููู ุตู ูููู.

ููุชุฎุฒููุง ูู ูุงุฆูุฉ ุถุฎูุฉ ูู RAM.

ุจุนุฏูู ูุจุฏุฃ ูุนุงูุฌูู ูุงุญุฏ ูุงุญุฏ.

ุงูุทุฑููุฉ ุจุงููููุฏ (generator):

ุงูุจุฑูุงูุฌ ุจูุงุฎุฏ ุตู ูุงุญุฏุ ูุนุงูุฌูุ ุจุนุฏูู ูุทูุจ ุงูุตู ุงููู ุจุนุฏู.

ุงูุฐุงูุฑุฉ ูุด ุจุชุชุฑุงูู.

ุงูุจุฑูุงูุฌ ูููู ูุดุชุบู ุจุดูู โstreamingโ ุญุชู ูู ุงูุฌุฏูู ุญุฌูู ูุจูุฑ ุฌุฏูุง.

๐ก ุงูููุฒุฉ ุงููุนููุฉ
ุงููุนูุงุฑ	fetchall()	generator (yield)
ุงูุฃุฏุงุก ูุน ุงูุจูุงูุงุช ุงูุตุบูุฑุฉ	ุฃุณุฑุน ุดููุฉ	ููุงุซู ุชูุฑูุจูุง
ุงูุฃุฏุงุก ูุน ุงูุจูุงูุงุช ุงููุจูุฑุฉ	ุจุทุฆ ุฌุฏูุง ุจุณุจุจ ุงูุฐุงูุฑุฉ	ุณุฑูุน ูุซุงุจุช
ุงุณุชููุงู ุงูุฐุงูุฑุฉ	ุถุฎู ุฌุฏูุง	ุดุจู ุตูุฑ
ููุช ุงูุจุฏุงูุฉ	ูุงุฒู ูุณุชูู ูู ุงููุชุงุฆุฌ	ูุจุฏุฃ ููุฑูุง
๐ฅ ูุซุงู ุนููู ุนูู ุงููุฑู
ุงูุณููุงุฑูู	ุนุฏุฏ ุงูุตููู	ุงุณุชููุงู ุงูุฐุงูุฑุฉ
fetchall()	1,000,000	ูููู ููุตู 500MB ุฃู ุฃูุชุฑ
generator	1,000,000	ุฃูู ูู 10MB
๐ง ุงูุฎูุงุตุฉ

ุงุณุชุฎุฏุงู generator ูู ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ููุน ูู ุงูู streaming
ุงููู ุจูุฎูู ุงูููุฏ:

ุฃุณุฑุน ูู ุงูุจุฏุงูุฉ

ุฃุฎู ุนูู ุงูุฐุงูุฑุฉ

ูุฃูุซุฑ ููุงุกุฉ ุฎุงุตุฉ ููุง ุชููู ุงูุจูุงูุงุช ูุจูุฑุฉ ุฌุฏูุง
'''